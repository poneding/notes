# shell 学习

## shell 注释

**单行注释**

```shell
# 注释内容
```

**多行注释**

```shell
:<<EOF
注释内容
注释内容
注释内容
EOF
```

或

```shell
:<<!
注释内容
注释内容
注释内容
!
```

或

```shell
:<<'
注释内容
注释内容
注释内容
'
```

## shell 变量

**定义变量**

```shell
my_name="Ding Peng"
```

**使用变量**

```shell
$my_name
${my_name}
```

**只读变量**

```shell
my_name="Ding Peng"
readonly my_name	
```

**删除变量**

```shell
unset my_name
```

**变量类型**

> 1. 局部变量：在脚本或命令中定义，仅在当前shell实例有效
> 2. 环境变量：所有shell实例有效
> 3. shell变量：shell程序设置的特殊变量

## shell 字符串

> 单引号与双引号的区别：
>
> 1. 单引号里的任何字符都会原样输出，单引号字符串中的变量是无效的；
> 2. 单引号字串中不能出现单独一个的单引号（对单引号使用转义符后也不行），但可成对出现，作为字符串拼接使用；
> 3. 双引号里可以有变量；
> 4. 双引号里可以出现转义字符

```shell
my_name="Ding Peng"
hello_string="Hllo,\"$my_name\"!"
echo $hello_string
```

**获取字符串长度**

```shell
my_name="dp"
echo ${#my_name}	# 输出5
```

**截取字符串**

```shell
hello_world="Hello World!"

# 从index 1截取4个字符
echo ${hello_world:1:4}		# 输出ello
```

## shell 数组

> 只有以为数组，没有多维数组

```shell
# 定义数组，空格隔开
names=('Ding Peng' 'Jay Chou' "Lebron James")

# 获取数组元素，根据index获取
echo ${names[1]}

# 获取数组长度
echo ${#names[@]}
echo ${#names[*]}
```

## shell 传参

执行shell脚本文件时，传递参数

假如有一个test.sh文件内容如下：

```shell
#!/bin/bash

echo "Shell 传递参数实例！";

# 使用$n接收参数
echo "执行的文件名：$0";
echo "第一个参数为：$1";
echo "第二个参数为：$2";
```

```shell
chmod +x test.sh
./test.sh 1 2 
```

> 第一行命令给test.sh添加可执行权限
>
> 第二行命令执行test.sh文件
>
> 以上命令将输出：
>
> ```shell
> Shell 传递参数实例！
> 执行的文件名：./test.sh
> 第一个参数为：1
> 第二个参数为：2
> ```

其他参数处理：

| 参数 | 说明                                                 |
| ---- | ---------------------------------------------------- |
| $#   | 传递到脚本的参数个数                                 |
| $*   | 以一个单字符串显示所有向脚本传递的参数               |
| $$   | 脚本运行的当前进程ID号                               |
| $@   | 与$*相同，但是使用时加引号，并在引号中返回每个参数。 |

## shell 运算符

### 算数运算符

```shell
val1=`expr 2 + 2`
val2=`expr 2 - 2`
val3=`expr 2 \* 2`	# *前面必须加\
val4=`expr 2 / 2`
val5=`expr 2 % 2`

echo "2 + 2: $val1"
echo "2 - 2: $val2"
echo "2 * 2: $val3"
echo "2 / 2: $val4"
echo "2 % 2: $val5"
```

> 注意：
>
> - 使用反引号而不是单引号；
> - 关键字expr；
> - 运算符如：+-*/% 字符前后都需要空格，否则被认为是字符串

其他算数运算符：

| 运算符 | 说明 | 示例                 |
| ------ | ---- | -------------------- |
| =      | 赋值 | a=$b                 |
| ==     | 判等 | `[ $a == $b ] 返回0` |
| !=     | 不等 | `[ $a != $b ] 返回1` |

### 关系运算符

| 运算符 | 说明     | 示例            |
| ------ | -------- | --------------- |
| -eq    | 等于     | `[ $a -eq $b ]` |
| -ne    | 不等于   |                 |
| -gt    | 大于     |                 |
| -lt    | 小于     |                 |
| -ge    | 大于等于 |                 |
| -le    | 小于等于 |                 |

> 注意：
>
> - 关系运算符只适用于数字，不支持字符串，除非字符串的值是数字

### 布尔运算符

| 运算符 | 说明   | 示例                         |
| ------ | ------ | ---------------------------- |
| !      | 非运算 | `[ $a != $b ]`               |
| -o     | 或运算 | `[ $a -eq $b -o $c -eq $d ]` |
| -a     | 与运算 | `[ $a -eq $b -a $c -eq $d ]` |

### 逻辑运算符

| 运算符 | 说明   | 示例                           |
| ------ | ------ | ------------------------------ |
| &&     | 与运算 | `[[ $a -eq $b && $c -eq $d ]]` |
| \|\|   | 或运算 | `[[ $a -eq $b || $c -eq $d ]]` |

> 说明：
>
> - 需要两层[]

### 字符串运算符

| 运算符 | 说明                            | 示例           |
| ------ | ------------------------------- | -------------- |
| =      | 判等                            | `[ $a = $b ]`  |
| !=     | 不等                            | `[ $a != $b ]` |
| -z     | 字符长度是否为0                 | `[ -z $a ]`    |
| -n     | 字符串长度不为0                 | `[ -n $b ]`    |
| $      | 字符串不为空，empty或whitespace | `[ $a ]`       |

### 文件测试运算符

| 运算符  | 说明                           | 示例               |
| ------- | ------------------------------ | ------------------ |
| -b file | 是否为块设备文件               | `[ -b $filepath ]` |
| -c file | 是否为字符设备文件             |                    |
| -d file | 是否为目录                     |                    |
| -f file | 是否为普通文件（非设备文件）   |                    |
| -g file | 是否设置SGID位                 |                    |
| -k file | 是否设置了粘着位（sticky bit） |                    |
| -p file | 是否有名管道                   |                    |
| -u file | 是否设置SUID位                 |                    |
| -r file | 是否可读                       |                    |
| -w file | 是否可写                       |                    |
| -x file | 是否可执行                     |                    |
| -s file | 是否不为空文件（文件大小为0）  |                    |
| -e file | 文件（目录）是否存在           |                    |
| -S file | 文件是否socket                 |                    |
| -L file | 文件是否存在并且是一个符号链接 |                    |

## shell 命令

### echo

**打印字符串**

> - 可以是带双引号，单引号，不带引号
> - 可以转义
> - 可以用参数

```shell
echo "Hello World"
echo 'Hello World'
echo Hello World

name="Ding Peng"
echo "Hello, $name!"

# -e 开启转义
echo -e "Hi Ding,\n"	# 两行之间空一行
echo "Nice to meet you."

echo -e "Hi Jay,\c"		# 不会换行，都在一行内输出
echo "Nice to meet you."	

echo -e "Hi James,\r"	# 会换行，但是没有\r也会默认换行的。
echo -e "Nice to meet you."
```

**打印到某文件**

```shell
echo "Hello World" > temp.txt	
```

**变量不转义，原样输出**

```shell
echo '$name'
echo '\*'
```

> 说明：
>
> - 需要用单引号

**显示命令执行结果**

```shell
echo `date`
```

> 说明：
>
> - 使用反引号，不是单引号

### read

> 交互，获取控制台输入并赋值给某变量

```shell
read name
echo $name
```

### printf

> 输出命令，移植性优于echo。默认不换行，可以在字符串后添加\n

```shell
printf "Hello\n"	
```

通过以下脚本学习printf命令的一些格式化功能

```shell
printf "%-10s %-8s %-4s\n" 姓名 性别 体重kg  
printf "%-10s %-8s %-4.2f\n" 郭靖 男 66.1234 
printf "%-10s %-8s %-4.2f\n" 杨过 男 48.6543 
printf "%-10s %-8s %-4.2f\n" 郭芙 女 47.9876 
```

> - %s %c %d %f都是格式替代符
> - %-10s 指一个宽度为10个字符（-表示左对齐，没有则表示右对齐），任何字符都会被显示在10个字符宽的字符内，如果不足则自动以空格填充，超过也会将内容全部显示出来。
> - %-4.2f 指格式化为小数，其中.2指保留2位小数。
